<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>World News Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
  /* Global Styles */
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    overflow: hidden;
    font-family: "Syne", sans-serif;
  }

  #info, #credits {
    position: absolute;
    width: 100%;
    text-align: center;
    color: teal;
    z-index: 1;
  }

  #info {
    bottom: 7.25vh;
  }

  #credits {
    bottom: 4.5vh;
  }

  #credits a {
    color: #1e90ff;
    text-decoration: none;
  }

  #credits a:hover {
    text-decoration: underline;
  }

  /* Ticker Styles */
  #dayTicker, #nightTicker {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 50px;
    z-index: 9999;
    font-family: Monospace;
    text-align: center;
    border: none;
    margin: 0;
  }

  iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  /* Button Styles */
  #toggleButton {
    position: absolute;
    right: 0px;
    top: 55px;
    padding: 4.5px 9.5px;
    font-size: 12px;
    background-color: rgba(225, 225, 225, 0.25);
    border: 1px solid rgba(225, 225, 225, 0.25);
    border-radius: 8px;
    color: rgba(155, 155, 155, 0.5);
    z-index: 9999;
    cursor: pointer;
  }

  #toggleButton:hover {
    background-color: rgba(225, 225, 225, 0.35);
  }

  /* Marker Labels */
  .marker-label {
    position: absolute;
    display: none;
    transition: opacity 0.5s ease;
    background-color: rgba(255, 255, 255, 0.9);
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    z-index: 9999;
  }

  .marker-label.active {
    display: block;
  }

  /* Footer Styles */
  footer {
    position: fixed;
    bottom: 0;
    width: 100%;
    background-color: #222;
    color: #fff;
    text-align: center;
    padding: 10px 0;
    font-size: 0.9rem;
    z-index: 9999;
  }

  footer a {
    color: #1e90ff;
    text-decoration: none;
  }

  footer a:hover {
    text-decoration: underline;
  }

  /* Responsive Footer for Mobile */
  @media (max-width: 768px) {
    footer {
      font-size: 0.8rem;
      padding: 8px 0;
    }

    .marker-label {
      font-size: 0.8rem;
      padding: 6px;
    }

    #toggleButton {
      font-size: 10px;
      padding: 3px 7px;
      top: 50px;
    }

    #dayTicker, #nightTicker {
      height: 40px;
      font-size: 12px;
    }
  }
  </style>
</head>
<body>
  <div id="labels-container"></div>
  <!-- Info Section -->
  <div id="info">Click the markers to show the label</div>
  <div id="credits">
    Made by
    <a href="https://www.linkedin.com/in/shange-fagan-bba3a3239/" target="_blank" rel="noopener">Shange Fagan</a>
  </div>

  <!-- Footer Section -->
  <footer>
    Â© 2024 World News Hub. All rights reserved. 
    <a href="https://www.linkedin.com/in/shange-fagan-bba3a3239/" target="_blank">LinkedIn</a> | 
    <a href="https://instagram.com/shangefagan" target="_blank">Instagram</a>
  </footer>

  <!-- Tickers -->
  <iframe
    id="dayTicker"
    src="https://rss.app/embed/v1/ticker/ye6DcnVZx4IHEsUK"
    frameborder="0"
    sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-modals allow-popups-to-escape-sandbox"
  ></iframe>
  <iframe
    id="nightTicker"
    src="https://rss.app/embed/v1/ticker/ye6DcnVZx4IHEsUK"
    frameborder="0"
    style="display: none;"
    sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-modals allow-popups-to-escape-sandbox"
  ></iframe>

  <button id="toggleButton">Switch to Night</button>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.136.0/build/three.module.js";
    import { OrbitControls } from "https://unpkg.com/three@0.136.0/examples/jsm/controls/OrbitControls.js";
    import { CSS2DRenderer } from "https://unpkg.com/three@0.136.0/examples/jsm/renderers/CSS2DRenderer.js";
    
    // Scene Setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 2000);
    camera.position.set(20, 0.5, 15).setLength(17);
    
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    document.body.appendChild(renderer.domElement);

    // Label Renderer
    const labelRenderer = new CSS2DRenderer();
    labelRenderer.setSize(window.innerWidth, window.innerHeight);
    labelRenderer.domElement.style.position = 'absolute';
    labelRenderer.domElement.style.top = '0px';
    document.body.appendChild(labelRenderer.domElement);

    // Controls
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.25;
    controls.autoRotate = true;
    controls.autoRotateSpeed = 0.25;

    // Lighting
    const ambientLight = new THREE.AmbientLight(0x808080); // Soft white light
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
    directionalLight.position.set(1, 1, 1);
    scene.add(directionalLight);

    // Load Textures and Cube Maps
    const textureLoader = new THREE.TextureLoader();
    const cubeTextureLoader = new THREE.CubeTextureLoader();
    const dayTexture = textureLoader.load("path_to_day_texture.jpg");
    const nightTexture = textureLoader.load("path_to_night_texture.jpg");

    const dayCubeMap = cubeTextureLoader.load([
     isMobile ? 'js/px.webp' : 'js/px.png', // Right face
  isMobile ? 'js/nx.webp' : 'js/nx.png', // Left face
  isMobile ? 'js/py.webp' : 'js/py.png', // Top face
  isMobile ? 'js/ny.webp' : 'js/ny.png', // Bottom face
  isMobile ? 'js/pz.webp' : 'js/pz.png', // Front face
  isMobile ? 'js/nz.webp' : 'js/nz.png'  // Back face
    ]);
    const nightCubeMap = cubeTextureLoader.load([
      isMobile ? 'js/px_(1).webp' : 'textures/px_(1).png', // Right face
  isMobile ? 'js/nx_(1).webp' : 'textures/nx_(1).png', // Left face
  isMobile ? 'js/py_(1).webp' : 'textures/py_(1).png', // Top face
  isMobile ? 'js/ny_(1).webp' : 'textures/ny_(1).png', // Bottom face
  isMobile ? 'js/pz_(1).webp' : 'textures/pz_(1).png', // Front face
  isMobile ? 'js/nz_(1).webp' : 'textures/nz_(1).png'  // Back face
    ]);

    // Globe Material
    const globeMaterial = new THREE.MeshPhongMaterial({
      map: dayTexture,
      bumpMap: textureLoader.load("//unpkg.com/three-globe/example/img/earth-topology.png"),
      bumpScale: 0.35,
      specularMap: textureLoader.load("//unpkg.com/three-globe/example/img/earth-water.png"),
      specular: 0x111111,
      shininess: 5
    });

    // Globe Geometry and Mesh
    const globeGeometry = new THREE.SphereGeometry(5.1, 32, 32);
    const globe = new THREE.Mesh(globeGeometry, globeMaterial);
    scene.add(globe);

    // Background Cube Map
    scene.background = dayCubeMap;

    // Toggle Day/Night Mode
    let isDay = true;
    document.getElementById('toggleButton').addEventListener('click', () => {
      if (isDay) {
        globe.material.map = nightTexture;
        scene.background = nightCubeMap;
        document.getElementById("dayTicker").style.display = "none";
        document.getElementById("nightTicker").style.display = "block";
        document.getElementById("toggleButton").textContent = "Switch to Day";
      } else {
        globe.material.map = dayTexture;
        scene.background = dayCubeMap;
        document.getElementById("dayTicker").style.display = "block";
        document.getElementById("nightTicker").style.display = "none";
        document.getElementById("toggleButton").textContent = "Switch to Night";
      }
      globe.material.needsUpdate = true;
      isDay = !isDay;
    });

    // Marker Data
    const markersData = [
      { id: 1, position: [5.1, 1.2, 1.5], iframeSrc: "https://rss.app/embed/v1/carousel/dIqCIlIGNRu8C6sq" },
      { id: 2, position: [5.1, 0.7, 1.8], iframeSrc: "https://rss.app/embed/v1/carousel/dIqCIlIGNRu8C6sq" },
      { id: 3, position: [5.1, 0.9, 0], iframeSrc: "https://rss.app/embed/v1/carousel/j4Lz0RvN9tozg8ti" }
      // Add more marker data here
    ];

    // Markers and Labels Setup
    const labelsContainer = document.getElementById("labels-container");
    const markerObjects = [];

    markersData.forEach((marker) => {
      const labelDiv = document.createElement("div");
      labelDiv.className = "marker-label";
      labelDiv.id = `label-${marker.id}`;

      const iframe = document.createElement("iframe");
      iframe.src = marker.iframeSrc;
      iframe.width = "250";
      iframe.height = "250";
      labelDiv.appendChild(iframe);
      labelsContainer.appendChild(labelDiv);

      const markerObject = new THREE.Object3D();
      const sphericalPosition = new THREE.Spherical(5.1, marker.position[1], marker.position[2]);
      markerObject.position.setFromSpherical(sphericalPosition);
      scene.add(markerObject);

      markerObjects.push({ labelDiv, markerObject, worldPosition: markerObject.position.clone() });
    });

    // Raycaster for Interactions
    const raycaster = new THREE.Raycaster();
    const pointer = new THREE.Vector2();

    window.addEventListener("pointerdown", onPointerClick);

    function onPointerClick(event) {
      pointer.x = (event.clientX / window.innerWidth) * 2 - 1;
      pointer.y = -(event.clientY / window.innerHeight) * 2 + 1;
      raycaster.setFromCamera(pointer, camera);

      const intersects = raycaster.intersectObjects(markerObjects.map(m => m.markerObject));
      if (intersects.length > 0) {
        const clickedMarker = markerObjects.find(m => m.markerObject === intersects[0].object);
        if (clickedMarker) {
          clickedMarker.labelDiv.classList.add("active");
          controls.autoRotate = false;
        }
      }
    }

    // Update Marker Positions and Opacity
    function updateMarkerLabels() {
      markerObjects.forEach(markerObj => {
        const { labelDiv, worldPosition } = markerObj;
        const screenPos = worldPosition.clone().project(camera);
        const x = (screenPos.x * 0.5 + 0.5) * window.innerWidth;
        const y = -(screenPos.y * 0.5 - 0.5) * window.innerHeight;
        labelDiv.style.transform = `translate(-50%, -50%) translate(${x}px, ${y}px)`;

        const distance = camera.position.distanceTo(worldPosition);
        labelDiv.style.opacity = Math.max(0, Math.min(1, 1 - distance / 20));
      });
    }

    // Animation Loop
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      updateMarkerLabels();
      renderer.render(scene, camera);
      labelRenderer.render(scene, camera);
    }

    animate();

    // Handle Window Resizing
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      labelRenderer.setSize(window.innerWidth, window.innerHeight);
    });

  </script>
</body>
</html>
